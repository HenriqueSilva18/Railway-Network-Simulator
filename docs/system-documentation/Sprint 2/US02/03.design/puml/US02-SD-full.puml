@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

autonumber

title Sequence Diagram: US02 - Add an industry

actor "Editor" as editor

participant ":EditMapUI" as mapUI
participant ":EditMapController" as mapCTRL
participant ":AddIndustryUI" as UI
participant ":AddIndustryController" as CTRL
participant "Repositories" as REPOS
participant "repositories\n:Repositories" as REPOS_SINGLETON
participant "industryRepository\n:IndustryRepository" as REPOS_IND
participant "mapRepository\n:MapRepository" as REPOS_MAP
participant "ApplicationSession" as APP_SESSION
participant "appSession\n:ApplicationSession" as APP_SESSION_SINGLETON
participant "map\n:Map" as MAP
participant "Industry" as IND

activate editor

    editor -> mapUI : asks to edit map

            activate mapUI
                mapUI -> mapCTRL**: create()
                mapUI -> mapCTRL: getAvailableMaps()

                activate mapCTRL

                    mapCTRL -> APP_SESSION: getInstance()
                            activate APP_SESSION
                                APP_SESSION --> mapCTRL:appSession
                            deactivate APP_SESSION

                            mapCTRL -> APP_SESSION_SINGLETON: setCurrentMap(selectedMap)
                            activate APP_SESSION_SINGLETON
                                APP_SESSION_SINGLETON --> mapCTRL: success
                            deactivate APP_SESSION_SINGLETON


                            mapCTRL -> REPOS_MAP: getMap(selectedMap)
                            activate REPOS_MAP
                                REPOS_MAP --> mapCTRL: map
                            deactivate REPOS_MAP

                            mapCTRL -> MAP: getMapLayout()
                            activate MAP
                                MAP --> mapCTRL: mapLayout
                            deactivate MAP

                    mapCTRL --> mapUI: availableMapsList
                deactivate mapCTRL

                mapUI --> editor: shows list of available maps
            deactivate mapUI

        editor -> mapUI: selects a map
            activate mapUI

                mapUI -> mapCTRL: loadMap(selectedMap)
                activate mapCTRL

                    mapCTRL -> REPOS: getInstance()
                        activate REPOS
                            REPOS --> mapCTRL: repositories
                        deactivate REPOS

                        mapCTRL -> REPOS_SINGLETON: getMapRepository()
                        activate REPOS_SINGLETON
                            REPOS_SINGLETON --> mapCTRL: MapRepository
                        deactivate REPOS_SINGLETON

                        mapCTRL -> REPOS_MAP: getAvailableMaps()
                        activate REPOS_MAP
                            REPOS_MAP --> mapCTRL: availableMapsList
                        deactivate REPOS_MAP

                    mapCTRL --> mapUI: mapLayout

                deactivate mapCTRL

                mapUI --> editor: loads and displays the selected map


            deactivate mapUI

    editor -> UI : asks to add industry
        activate UI

            UI -> CTRL**: create()
            UI -> CTRL: getAvailableIndustries()

            activate CTRL
                CTRL -> REPOS: getInstance()
                activate REPOS
                    REPOS --> CTRL: repositories
                deactivate REPOS

                CTRL -> REPOS_SINGLETON: getIndustryRepository()
                activate REPOS_SINGLETON
                    REPOS_SINGLETON --> CTRL: industryRepository
                deactivate REPOS_SINGLETON



                CTRL -> REPOS_IND: getAvailableIndustries()
                activate REPOS_IND
                    REPOS_IND --> CTRL: availableIndustriesList
                deactivate REPOS_IND

                CTRL --> UI: availableIndustriesList
            deactivate CTRL

        UI --> editor: shows all industries available in the list
        deactivate UI

    editor -> UI: selects industry
        activate UI
        UI --> editor: requests industry data (nameID, X and Y coordinates)
        deactivate UI

    editor -> UI: types industry data (nameID, X, Y)
        activate UI
        UI -> CTRL: validateIndustry(nameID, x, y)
            activate CTRL

            CTRL -> APP_SESSION: getInstance()
            activate APP_SESSION
                APP_SESSION --> CTRL: cMap = appSession
            deactivate APP_SESSION

            CTRL -> REPOS_SINGLETON: getIMapRepository()
            activate REPOS_SINGLETON
                REPOS_SINGLETON --> CTRL: mapRepository
            deactivate REPOS_SINGLETON

            CTRL -> REPOS_MAP: getCurrentMap(cMap)
            activate REPOS_MAP
                REPOS_MAP --> CTRL: map
            deactivate REPOS_MAP

            CTRL -> MAP: isCellEmpty(x, y)
            activate MAP
                MAP --> CTRL: cellIsEmpty
            deactivate MAP


                CTRL --> UI: success
            deactivate CTRL

        UI --> editor: asks for confirmation
        deactivate UI

    editor -> UI: confirms industry data
        activate UI
            UI -> CTRL: createIndustry(nameID, x, y)
            activate CTRL

            CTRL -> IND: create(nameID, x, y)
                activate IND
                    IND --> CTRL: newIndustry
                deactivate IND

                CTRL -> MAP: addIndustry(newIndustry)
                activate MAP
                    MAP --> CTRL: success
                deactivate MAP

                CTRL -> REPOS_MAP: save(currentMap)
                activate REPOS_MAP
                    REPOS_MAP --> CTRL: success
                deactivate REPOS_MAP

               CTRL --> UI: success + industryDetails
               deactivate CTRL

            UI --> editor: displays operation success
            UI --> editor: shows industry details on map

        deactivate UI

deactivate editor

@enduml