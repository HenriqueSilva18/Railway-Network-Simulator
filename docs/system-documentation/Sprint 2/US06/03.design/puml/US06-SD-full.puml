@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

autonumber

title Sequence Diagram: US06 - Upgrade a selected station with a building

actor "Player" as player
participant ":UpgradeStationUI" as UI
participant ":UpgradeStationController" as CTRL
participant "Repositories" as REPOS
participant "repositories\n:Repositories" as REPOS_SINGLETON
participant "ApplicationSession" as APP_SESSION
participant "stationRepository\n:StationRepository" as REPOS_STATION
participant ":station\nStation" as station
participant "building\n:Building" as building
participant "buildingRepository\n:BuildingRepository" as REPOS_BUILDING


activate player

    player -> UI: asks to upgrade station
        activate UI
        UI -> CTRL**: create()
            UI -> CTRL: getAvailableUpgrades()
            activate CTRL

            CTRL -> REPOS: getInstance()
                activate REPOS
                    REPOS --> CTRL: repositories
                deactivate REPOS

            CTRL -> REPOS_SINGLETON: getStationRepository()
                activate REPOS_SINGLETON
                    REPOS_SINGLETON --> CTRL: stationRepository
                deactivate REPOS_SINGLETON

            CTRL -> APP_SESSION: getInstance()
                activate APP_SESSION
                    APP_SESSION --> CTRL: stationId = appSession
                deactivate APP_SESSION

            CTRL -> REPOS_STATION: getStation(stationId)
                activate REPOS_STATION
                    REPOS_STATION --> CTRL: station
                deactivate REPOS_STATION

            CTRL -> station: getAvailableUpgrades(station)
                activate station
                station --> CTRL: availableUpgrades
                deactivate station
            CTRL --> UI: availableUpgrades
            deactivate CTRL
        UI --> player: displays upgrade options
        deactivate UI
        
    player -> UI: chooses building to upgrade
        activate UI
        UI -> CTRL: getBuildingInfo(buildingId)
            activate CTRL
            
            CTRL -> REPOS_SINGLETON: getBuildingRepository()
                activate REPOS_SINGLETON
                    REPOS_SINGLETON --> CTRL: buildingRepository
                deactivate REPOS_SINGLETON
                
            CTRL -> REPOS_BUILDING: getBuilding(buildingId)
                activate REPOS_BUILDING
                    REPOS_BUILDING --> CTRL: building
                deactivate REPOS_BUILDING
                
            CTRL -> building: getInfo()
                activate building
                building --> CTRL: buildingInfo
                deactivate building
                
            CTRL --> UI: buildingInfo
            deactivate CTRL
        UI --> player: displays building information
        UI --> player: asks for confirmation
        deactivate UI
        
    player -> UI: confirms upgrade
        activate UI
        UI -> CTRL: upgradeStation()
            activate CTRL
                
            CTRL -> station: upgrade(building)
                activate station
                station --> CTRL: success
                deactivate station
                
            CTRL -> REPOS_STATION: save(station)
                activate REPOS_STATION
                REPOS_STATION --> CTRL: success
                deactivate REPOS_STATION
                
            CTRL --> UI: success
            deactivate CTRL
            
        UI --> player: displays operation success
        UI -> CTRL: getStationInfo(stationId)
            activate CTRL
            
            CTRL -> station: getInfo()
                activate station
                station --> CTRL: stationInfo
                deactivate station

            CTRL -> building: getInfo()
                activate building
                building --> CTRL: buildingInfo
                deactivate building
                
            CTRL --> UI: stationInfo
            CTRL --> UI: buildingInfo
            deactivate CTRL
            
        UI --> player: displays station and building information
        deactivate UI

deactivate player

@enduml