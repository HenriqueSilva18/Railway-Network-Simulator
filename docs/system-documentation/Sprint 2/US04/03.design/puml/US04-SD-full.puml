@startuml
'skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

autonumber

'hide footbox
actor "Editor" as EDITOR
participant ":CreateScenarioUI" as UI
participant ":CreateScenarioController" as CTRL
participant "Repositories" as REPOS
participant "repositories\n:Repositories" as REPOS_SINGLETON
participant "mapRepository\n:MapRepository" as MAP_REPO
participant "industryRepository\n:IndustryRepository" as INDUSTRY_REPO
participant "cargoRepository\n:CargoRepository" as CARGO_REPO
participant "locomotiveRepository\n:LocomotiveRepository" as LOCOMOTIVE_REPO
participant "ApplicationSession" as APP_SESSION
participant "appSession\n:ApplicationSession" as APP_SESSION_SINGLETON
participant "currentSession\n:UserSession" as CURRENT_SESSION

participant "scenario\n:Scenario" as SCENARIO

activate EDITOR

    EDITOR -> UI : asks to create a scenario
    activate UI
        UI --> CTRL** : create()

        UI -> CTRL : getMaps()
        activate CTRL
            CTRL -> REPOS : getInstance()
            activate REPOS
                REPOS --> CTRL: repositories
            deactivate REPOS

            CTRL -> REPOS_SINGLETON : getMapRepository()
            activate REPOS_SINGLETON
                REPOS_SINGLETON --> CTRL: mapRepository
            deactivate REPOS_SINGLETON

            CTRL -> MAP_REPO : getMaps()
            activate MAP_REPO
                MAP_REPO --> CTRL : mapsList
            deactivate MAP_REPO

            CTRL --> UI : mapsList
        deactivate CTRL

        UI --> EDITOR : shows map list and asks to select one
    deactivate UI

    EDITOR -> UI : selects a map
    activate UI
        UI --> EDITOR : requests name, start and end date (time period)
    deactivate UI

    EDITOR -> UI : types requested data
    activate UI
        UI -> CTRL : getAvailableIndustries(startDate, endDate)
        activate CTRL
            CTRL -> REPOS : getInstance()
            activate REPOS
                REPOS --> CTRL: repositories
            deactivate REPOS

            CTRL -> REPOS_SINGLETON : getIndustryRepository()
            activate REPOS_SINGLETON
                REPOS_SINGLETON --> CTRL: industryRepository
            deactivate REPOS_SINGLETON

            CTRL -> INDUSTRY_REPO : getAvailableIndustries(startDate, endDate)
            activate INDUSTRY_REPO
                INDUSTRY_REPO --> CTRL : availableIndustriesList
            deactivate INDUSTRY_REPO

            CTRL --> UI : availableIndustriesList
        deactivate CTRL

        UI --> EDITOR : shows a list of industries and asks to select the ones available in the scenario
    deactivate UI

    EDITOR -> UI : selects the available industries in the scenario
    activate UI

            UI -> CTRL : getAvailableCargoes()
            activate CTRL
                CTRL -> REPOS : getInstance()
                activate REPOS
                    REPOS --> CTRL: repositories
                deactivate REPOS

                CTRL -> REPOS_SINGLETON : getCargoRepository()
                activate REPOS_SINGLETON
                    REPOS_SINGLETON --> CTRL: cargoRepository
                deactivate REPOS_SINGLETON

                CTRL -> CARGO_REPO : getAvailableCargoes()
                activate CARGO_REPO
                    CARGO_REPO --> CTRL : availableCargoesList
                deactivate CARGO_REPO

                CTRL --> UI : availableCargoesList

            deactivate CTRL

        loop for each selected industry that is a port (mixed industries)

                UI --> UI : availableCargoList

            UI --> EDITOR : shows a list of cargoes and asks to select the ones the port import
            deactivate UI


            EDITOR -> UI : selects the cargoes the port import
            activate UI
                UI --> UI : availableCargoList

            UI --> EDITOR : shows a list of cargoes and asks to select the ones the port export
            deactivate UI

            EDITOR -> UI : selects the cargoes the port export
            activate UI
                UI --> UI : availableCargoList

            UI --> EDITOR : shows a list of cargoes and asks to select the ones the port transform
            deactivate UI

            EDITOR -> UI : selects the cargoes the port transform
            activate UI
        end

        loop for each industry
            UI --> EDITOR : requests the industry generation frequency factor
            deactivate UI

            EDITOR -> UI : types the industry generation factor
            activate UI
        end

        UI -> CTRL : getLocomotiveTypes()
        activate CTRL
            CTRL -> REPOS : getInstance()
            activate REPOS
                REPOS --> CTRL: repositories
            deactivate REPOS

            CTRL -> REPOS_SINGLETON : getLocomotiveRepository()
            activate REPOS_SINGLETON
                REPOS_SINGLETON --> CTRL: locomotiveRepository
            deactivate REPOS_SINGLETON

            CTRL -> LOCOMOTIVE_REPO : getLocomotiveTypes()
            activate LOCOMOTIVE_REPO
                LOCOMOTIVE_REPO --> CTRL : locomotiveTypeList
            deactivate LOCOMOTIVE_REPO

            CTRL --> UI : locomotiveTypeList
        deactivate CTRL

        UI --> EDITOR : shows a list of locomotive types and asks to select the available ones
    deactivate UI

    EDITOR -> UI : selects the available locomotive types
    activate UI
        UI --> EDITOR : shows all data and requests confirmation
    deactivate UI

    EDITOR -> UI : confirms data
    activate UI
        UI -> CTRL : createScenario(nameID, startDate, endDate, mapID, selectedIndustries, \nportImports, portExports, portTransforms, industryGenerationFactors, selectedLocomotiveTypes)
        activate CTRL
            CTRL -> CTRL : getEditorFromSession()
            activate CTRL
                CTRL -> APP_SESSION: getInstance()
                activate APP_SESSION
                    APP_SESSION -> CTRL: appSession
                deactivate APP_SESSION

                CTRL -> APP_SESSION_SINGLETON: getCurrentSession()
                activate APP_SESSION_SINGLETON
                    APP_SESSION_SINGLETON --> CTRL: currentSession
                deactivate APP_SESSION_SINGLETON

                CTRL -> CURRENT_SESSION: getUsername()
                activate CURRENT_SESSION
                    CURRENT_SESSION --> CTRL: username
                deactivate CURRENT_SESSION

                CTRL -> REPOS : getInstance()
                activate REPOS
                    REPOS --> CTRL: repositories
                deactivate REPOS

                CTRL -> REPOS_SINGLETON: getEditorRepository()
                activate REPOS_SINGLETON
                    REPOS_SINGLETON --> CTRL: editorRepository
                deactivate REPOS_SINGLETON

                CTRL -> CTRL : getEditorByUsername(username)
                activate CTRL
                    CTRL --> CTRL : editor
                deactivate CTRL

                CTRL --> CTRL : editor
            deactivate CTRL



            CTRL --> SCENARIO** : create(nameID, startDate, endDate, mapID, editor)

            loop for each selectedIndustry
                CTRL -> SCENARIO : configureIndustry(industry, generationFactor)
                activate SCENARIO
                    SCENARIO --> CTRL : true
                deactivate SCENARIO
            end

            loop for each port
                CTRL -> SCENARIO : configurePortCargoes(port, imports, exports, transforms)
                activate SCENARIO
                    SCENARIO --> CTRL : true
                deactivate SCENARIO
            end

            loop for each selectedLocomotive
                CTRL -> SCENARIO : configureLocomotive(locomotive)
                activate SCENARIO
                    SCENARIO --> CTRL : true
                deactivate SCENARIO
            end

            CTRL --> UI : scenario
        deactivate CTRL

        UI --> EDITOR : displays operation success
    deactivate UI

deactivate EDITOR

@enduml