@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

autonumber

participant ":CreateMapController" as CTRL
participant "Repositories" as REPOS
participant "repositories\n:Repositories" as REPOS_SINGLETON
participant "mapRepository\n:MapRepository" as REPOS_MAP
participant "ApplicationSession" as APP_SESSION
participant "appSession\n:ApplicationSession" as APP_SESSION_SINGLETON
participant "editor\n:Editor" as EDITOR
participant "Map" as MAP
participant "Size" as SIZE

autonumber 11
-> CTRL: createMap(nameID, width, height)
    activate CTRL
    autonumber 11.1
    group Create and save map
        CTRL -> APP_SESSION: getInstance()
        activate APP_SESSION
            APP_SESSION --> CTRL: appSession
        deactivate APP_SESSION
        
        CTRL -> APP_SESSION_SINGLETON: getCurrentSession()
        activate APP_SESSION_SINGLETON
            APP_SESSION_SINGLETON --> CTRL: editor
        deactivate APP_SESSION_SINGLETON
        
        CTRL -> SIZE**: createSize(width, height)
        
        CTRL -> EDITOR: createMap(nameID, size)
        activate EDITOR
            EDITOR -> MAP**: createMap(nameID, size)
            
            EDITOR --> CTRL: map
        deactivate EDITOR
        
        CTRL -> REPOS: getInstance()
        activate REPOS
            REPOS --> CTRL: repositories
        deactivate REPOS
        
        CTRL -> REPOS_SINGLETON: getMapRepository()
        activate REPOS_SINGLETON
            REPOS_SINGLETON --> CTRL: mapRepository
        deactivate REPOS_SINGLETON
        
        CTRL -> REPOS_MAP: save(map)
        activate REPOS_MAP
            REPOS_MAP --> CTRL: success
        deactivate REPOS_MAP
    end
    autonumber 12
    <-- CTRL: success + mapDetails
deactivate CTRL

@enduml 