@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

autonumber

participant ":AddCityController" as CTRL
participant "Repositories" as REPOS
participant "repositories\n:Repositories" as REPOS_SINGLETON
participant "map\n:Map" as MAP
participant "mapRepository\n:MapRepository" as REPOS_MAP
participant "ApplicationSession" as APP_SESSION
participant "Position" as POSITION

autonumber 12
-> CTRL: validateCoordinates(x, y)
        activate CTRL
        autonumber 12.1
        group Validate Coordinates
            CTRL -> APP_SESSION: getInstance()
            activate APP_SESSION
                APP_SESSION --> CTRL: appSession
            deactivate APP_SESSION

            CTRL -> REPOS_SINGLETON: getInstance()
            activate REPOS_SINGLETON
                REPOS_SINGLETON --> CTRL: repositories
            deactivate REPOS_SINGLETON
            
            CTRL -> REPOS_SINGLETON: mapRepository()
            activate REPOS_SINGLETON
                REPOS_SINGLETON --> CTRL: mapRepository
            deactivate REPOS_SINGLETON

            CTRL -> REPOS_MAP: getCurrentMap()
            activate REPOS_MAP
                REPOS_MAP --> CTRL: map
            deactivate REPOS_MAP

            CTRL -> MAP: isPositionAvailable(x, y)
            activate MAP
                MAP --> CTRL: isAvailable
            deactivate MAP

            alt position is available
                CTRL -> POSITION: new Position(x, y)
                activate POSITION
                    POSITION --> CTRL: position
                deactivate POSITION
            else position not available
                CTRL --> CTRL: throw InvalidPositionException
            end
        end
        autonumber 13
        <-- CTRL: position
deactivate CTRL

@enduml