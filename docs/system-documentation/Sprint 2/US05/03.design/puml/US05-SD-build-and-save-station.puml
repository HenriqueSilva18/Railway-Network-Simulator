@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

autonumber

participant ":BuildStationController" as CTRL
participant "Repositories" as REPOS
participant "repositories\n:Repositories" as REPOS_SINGLETON
participant "stationRepository\n:StationRepository" as REPOS_STATION
participant "ApplicationSession" as APP_SESSION
participant "appSession\n:ApplicationSession" as APP_SESSION_SINGLETON
participant "player\n:Player" as PLAYER
participant "station\n:Station" as STATION

autonumber 16
-> CTRL: buildStation(nameID, stationType, position)
    activate CTRL
    autonumber 16.1
    group Build and save station
        CTRL -> APP_SESSION: getInstance()
        activate APP_SESSION
            APP_SESSION --> CTRL: appSession
        deactivate APP_SESSION
        
        CTRL -> APP_SESSION_SINGLETON: getCurrentSession()
        activate APP_SESSION_SINGLETON
            APP_SESSION_SINGLETON --> CTRL: player
        deactivate APP_SESSION_SINGLETON
        
        CTRL -> PLAYER: buildStation(nameID, stationType, position)
        activate PLAYER
            PLAYER -> STATION**: create(nameID, stationType, position)
            PLAYER -> PLAYER: updateBudget(stationType.getCost())
            PLAYER --> CTRL: station
        deactivate PLAYER
        
        CTRL -> REPOS: getInstance()
        activate REPOS
            REPOS --> CTRL: repositories
        deactivate REPOS
        
        CTRL -> REPOS_SINGLETON: getStationRepository()
        activate REPOS_SINGLETON
            REPOS_SINGLETON --> CTRL: stationRepository
        deactivate REPOS_SINGLETON
        
        CTRL -> REPOS_STATION: save(station)
        activate REPOS_STATION
            REPOS_STATION --> CTRL: success
        deactivate REPOS_STATION
    end
    autonumber 17
    <-- CTRL: success + stationDetails
deactivate CTRL

@enduml 