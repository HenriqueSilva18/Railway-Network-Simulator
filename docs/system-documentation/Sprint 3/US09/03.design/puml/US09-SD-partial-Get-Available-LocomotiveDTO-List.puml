@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

participant ":BuyLocomotiveController" as CTRL
participant "Repositories" as REPOS
participant "repositories\n:Repositories" as REPOS_SINGLETON
participant "ApplicationSession" as APP_SESSION
participant "appSession\n:ApplicationSession" as APP_SESSION_SINGLETON
participant "currentSession\n:UserSession" as CURRENT_SESSION
participant "scenario\n:Scenario" as SCN
participant "locomotiveRepository\n:LocomotiveRepository" as LOC_REPO
participant "locomotives\n:Locomotives" as LOCS
participant ":List<Locomotive>" as LIST
participant "locomotive:Locomotive" as LOC
participant ":LocomotiveMapper" as LOC_MAPPER
participant "listLocomotive\n:List<Locomotive>" as LOC_LIST
participant "listLocomotiveDTO\n:List<LocomotiveDTO>" as LOC_LIST_DTO
participant "locomotiveDTO\n:LocomotiveDTO" as LOC_DTO

autonumber 1
-> CTRL: getAvailableLocomotives()

autonumber 1.1
activate CTRL
    group Get Available LocomotiveDTO List

        CTRL -> APP_SESSION: getInstance()
        activate APP_SESSION
            APP_SESSION --> CTRL: appSession
        deactivate APP_SESSION

        CTRL -> APP_SESSION_SINGLETON: getCurrentSession()
        activate APP_SESSION_SINGLETON
            APP_SESSION_SINGLETON --> CTRL: currentSession
        deactivate APP_SESSION_SINGLETON

        CTRL -> CURRENT_SESSION: getCurrentDate()
        activate CURRENT_SESSION
            CURRENT_SESSION --> CTRL: currentDate
        deactivate CURRENT_SESSION

        CTRL -> CURRENT_SESSION: getCurrentScenario()
        activate CURRENT_SESSION
            CURRENT_SESSION --> CTRL: scenario
        deactivate CURRENT_SESSION

        CTRL -> SCN: getLocomotiveTypes()
        activate SCN
            SCN --> CTRL: locomotiveTypes
        deactivate SCN

        CTRL -> REPOS : getInstance()
        activate REPOS
            REPOS --> CTRL: repositories
        deactivate REPOS

        CTRL -> REPOS_SINGLETON: getLocomotiveRepository()
        activate REPOS_SINGLETON
            REPOS_SINGLETON --> CTRL: locomotiveRepository
        deactivate REPOS_SINGLETON

        CTRL -> LOC_REPO: getAvailableLocomotives(currentDate, locomotiveTypes)
        activate LOC_REPO
            LOC_REPO -> LOCS: getAvailableLocomotives(currentDate, locomotiveTypes)
            activate LOCS

                LOCS --> LOC_LIST**: create()

                loop for each available Locomotive
                    LOCS -> LIST: locomotive = get(i)
                    activate LIST
                        deactivate LIST

                        LOCS -> LOC: isAvailable = checkAvailability(locomotive, currentDate, locomotiveTypes)
                        activate LOC
                            deactivate LOC

                    opt isAvailable == true
                    LOCS -> LOC_LIST: add(locomotive)
                    activate LOC_LIST
                        deactivate LOC_LIST
                    end
                end

                LOCS --> LOC_REPO: listLocomotive
            deactivate LOCS

            LOC_REPO --> CTRL: listLocomotive
        deactivate LOC_REPO

        CTRL -> LOC_MAPPER: toDTO(listLocomotive)
        activate LOC_MAPPER

            LOC_MAPPER --> LOC_LIST_DTO**: create()

            loop for each object in listLocomotive
                LOC_MAPPER -> LOC_LIST: locomotive = get(i)
                activate LOC_LIST
                    deactivate LOC_LIST

                LOC_MAPPER -> LOC_MAPPER: locomotiveDTO = toDTO(locomotive)
                activate LOC_MAPPER
                    LOC_MAPPER --> LOC_DTO**: create()
                    deactivate LOC_MAPPER

                LOC_MAPPER -> LOC_LIST_DTO: add(locomotiveDTO)
                activate LOC_LIST_DTO
                    deactivate LOC_LIST_DTO
            end

            LOC_MAPPER --> CTRL: listLocomotiveDTO
        deactivate LOC_MAPPER

    end

    autonumber 2
    <-- CTRL : listLocomotiveDTO
deactivate CTRL

@enduml
