@startuml

skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

participant ":UpgradeStationController" as CTRL
participant "Repositories" as REPOS
participant "repositories\n:Repositories" as REPOS_SINGLETON
participant ":ApplicationSession" as APP_SESSION
participant "appSession\n:ApplicationSession" as APP_SESSION_SINGLETON

participant "stationMapper\n:StationMapper" as MAPPER_STATION
participant "currentScenario\n:Scenario" as SCENARIO
participant "stations\n:Stations" as STATIONS
participant "listStation : List<Station>" as LIST_STATION
participant "listStationDTO\n:List<StationDTO>" as LIST_STATION_DTO
participant "stationDTO\n:StationDTO" as DTO_STATION

autonumber 3

 -> CTRL: getListOfStationsDTO()
    activate CTRL
        group Get StationsDTO List
        autonumber 3.1

            CTRL -> APP_SESSION: getInstance()
            activate APP_SESSION
                APP_SESSION --> CTRL : appSession
            deactivate APP_SESSION

            CTRL -> APP_SESSION_SINGLETON: getCurrentScenario()
            activate APP_SESSION_SINGLETON
                APP_SESSION_SINGLETON --> CTRL : currentScenario
            deactivate APP_SESSION_SINGLETON

            ' Scenario configures stations: Scenario "1" -- "*" Station : configures >
            CTRL -> SCENARIO : getStations()
            activate SCENARIO
            SCENARIO -> STATIONS: getStations()
            activate STATIONS
                STATIONS -> LIST_STATION**: create()
                loop for each known Station
                    STATIONS -> LIST_STATION: obj = get(i)
                    activate LIST_STATION
                        deactivate LIST_STATION

                    STATIONS -> LIST_STATION : add(obj)
                    activate LIST_STATION
                        deactivate LIST_STATION
                end
                STATIONS --> SCENARIO : listStations
            deactivate STATIONS
                SCENARIO --> CTRL : listStations
            deactivate SCENARIO

            CTRL -> MAPPER_STATION : toStationDTOs(List<Station>)
            activate MAPPER_STATION
                loop for each station in List<Station>
                MAPPER_STATION -> LIST_STATION: obj = get(i)
                activate LIST_STATION
                deactivate LIST_STATION

                MAPPER_STATION -> MAPPER_STATION : objDTO = toDTO(obj)
                activate MAPPER_STATION
                deactivate MAPPER_STATION

                MAPPER_STATION -> DTO_STATION**: create(...)
                MAPPER_STATION --> LIST_STATION_DTO : add(stationDTO)
                activate LIST_STATION_DTO
                deactivate LIST_STATION_DTO

                end
                MAPPER_STATION --> CTRL : listStationDTO
            deactivate MAPPER_STATION
        end
        autonumber 4
        <-- CTRL: listStationDTO
    deactivate CTRL
@enduml