# User Story 31 – Cargo-Revenue Correlation and Regression Analysis

##  Introduction

In the context of railway station operations, understanding how various types of **cargo traffic** influence **revenue** is essential for financial planning and decision-making.
This user story implements a **statistical and predictive model** using **simple linear regression** to analyze the correlation between a cargo type (independent variable $x$) and revenue (dependent variable $y$).

---

##  Objectives

1. **Load and clean the dataset (`Stations_Data.csv`)**
2. **Group the data by station and year**
3. **Calculate the correlation coefficient** to identify which cargo type most influences revenue
5. **Perform simple linear regression** using that cargo type
6. **Predict revenue**
7. **Generate a 95% confidence interval** for the prediction
8. **Visualize the regression** with the fitted line, real data points, and confidence bounds

---

## Data Cleaning and Preparation

To prepare the data for regression analysis, we:
1. Convert all numeric columns to the correct format by replacing decimal commas with points.
2. Select only the relevant **cargo columns** (e.g., Iron, Coal, Wool...) and the **Revenue**.
3. Group the dataset by **Station** and **Year**.
4. Aggregate the **sum of cargo volumes** and **revenue** per year per station.
5. Store the result in a new DataFrame, where each row represents a station-year and the columns are the cargo volumes and total revenue.

This allows us to study how the variation in different types of cargo influences the overall revenue using regression techniques described in Chapter 6.

##  Mathematical Foundation

###  1. Simple Linear Regression
The goal is to model:

$$
y = \beta_0 + \beta_1 x + \varepsilon
$$

Where:
- $y$ = Revenue (dependent variable)
- $x$ = Cargo volume (independent variable)
- $\beta_0$ = Intercept
- $\beta_1$ = Slope
- $\varepsilon$ = Random error term

We estimate the coefficients using the **least squares method**:

$$
\hat{\beta}_1 = \frac{S_{xy}}{S_{xx}}, \quad \hat{\beta}_0 = \bar{y} - \hat{\beta}_1 \bar{x}
$$

Where:

$$
S_{xy} = \sum (x_i - \bar{x})(y_i - \bar{y}), \quad S_{xx} = \sum (x_i - \bar{x})^2
$$

---
##  Correlation Analysis

We now calculate the **Pearson correlation coefficient** between each cargo type and revenue.

This helps us determine which cargo type has the **strongest linear relationship** with revenue.
We will use this variable as the **independent variable** ($x$) in our regression model.

The Pearson correlation coefficient is:

$$
r = \frac{\sum (x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum (x_i - \bar{x})^2 \sum (y_i - \bar{y})^2}}
$$

A value of $|r|$ closer to 1 indicates a **stronger correlation**.



## Predict January Revenue for Next Year with 10% More Cargo

The amount of the most correlated cargo increases by 10% in January of the following year.

We'll use the regression model:

$$\hat{y} = \beta_0 + \beta_1 \cdot x$$

Where:
- $\hat{y}$ is the predicted revenue
- $x$ is the new cargo value (10% increase over this year’s January cargo)

### 95% Confidence Interval for the Mean (IC) and Prediction Interval (IP)

We compute the 95% **Confidence Interval (IC)** for the *mean response* and the 95% **Prediction Interval (IP)** for a *new individual observation*.

The formula for the **Confidence Interval for the Mean Response** $E(Y|x_p)$ is:

$$\hat{y}_p \pm t_{\alpha/2, n-2} \cdot s \sqrt{\frac{1}{n} + \frac{(x_p - \bar{x})^2}{S_{xx}}}$$

The formula for the **Prediction Interval for a New Observation** $Y_p$ is:

$$\hat{y}_p \pm t_{\alpha/2, n-2} \cdot s \sqrt{1 + \frac{1}{n} + \frac{(x_p - \bar{x})^2}{S_{xx}}}$$

Where:
- $\hat{y}_p$ = predicted value
- $s^2$ = estimated variance of the residuals (MSE)
- $s$ = standard error of regression ($\sqrt{MSE}$)
- $S_{xx}$ = sum of squares of $x$ deviations
- $t_{\alpha/2, n-2}$ = t-value for desired confidence level from Student's t-distribution with $n-2$ degrees of freedom
- $n$ = number of observations
- $x_p$ = the specific value of the independent variable for which prediction is made
- $\bar{x}$ = mean of the independent variable


